<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Working with the Bulk APIs • salesforcer</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/spacelab/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Working with the Bulk APIs">
<meta property="og:description" content="salesforcer">
<meta property="og:image" content="https://stevenmmortimer.github.io/salesforcer/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-98603021-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-98603021-2');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">salesforcer</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.4.999</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa fas fa-book"></span>
     
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/getting-started.html">Getting Started</a>
    </li>
    <li>
      <a href="../articles/supported-queries.html">Supported Queries</a>
    </li>
    <li>
      <a href="../articles/working-with-the-bulk-apis.html">Working with the Bulk APIs</a>
    </li>
    <li>
      <a href="../articles/working-with-attachments.html">Working with Attachments</a>
    </li>
    <li>
      <a href="../articles/working-with-metadata.html">Working with Metadata</a>
    </li>
    <li>
      <a href="../articles/passing-control-args.html">Passing Control Args</a>
    </li>
    <li>
      <a href="../articles/transitioning-from-RForcecom.html">Transitioning from RForcecom</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fa fa-file-code-o"></span>
     
    Reference
  </a>
</li>
<li>
  <a href="../news/index.html">
    <span class="fa fa-newspaper-o"></span>
     
    News
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/StevenMMortimer/salesforcer">
    <span class="fa fa-github fa-lg"></span>
     
    GitHub
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Working with the Bulk APIs</h1>
                        <h4 class="author">Steven M. Mortimer</h4>
            
            <h4 class="date">2020-06-07</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/StevenMMortimer/salesforcer/blob/master/vignettes/working-with-the-bulk-apis.Rmd"><code>vignettes/working-with-the-bulk-apis.Rmd</code></a></small>
      <div class="hidden name"><code>working-with-the-bulk-apis.Rmd</code></div>

    </div>

    
    
<div id="using-the-bulk-api" class="section level2">
<h2 class="hasAnchor">
<a href="#using-the-bulk-api" class="anchor"></a>Using the Bulk API</h2>
<p>First, load the <strong>salesforcer</strong> and <strong>dplyr</strong> packages and login, if needed.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/warning.html">suppressWarnings</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressMessages</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)))
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">microbenchmark</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">salesforcer</span>)
<span class="fu"><a href="../reference/sf_auth.html">sf_auth</a></span>()</pre></body></html></div>
<p>For really large inserts, updates, deletes, upserts, and queries you can just add <code>api_type = "Bulk 1.0"</code> to most functions to get the benefits of using the Bulk API instead of the SOAP or REST APIs. The change you have to make from using the REST API to the Bulk 1.0 API as simple as adding <code>api_type="Bulk 1.0"</code> to your function arguments. First, let’s build a <code>tbl_df</code> with two new records to be created.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">n</span> <span class="kw">&lt;-</span> <span class="fl">2</span>
<span class="no">prefix</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"Bulk-"</span>, <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span>(<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">100000</span>)), <span class="st">"-"</span>)
<span class="no">new_contacts1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">tibble</a></span>(<span class="kw">FirstName</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="st">"Test"</span>, <span class="no">n</span>),
                        <span class="kw">LastName</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"Contact-Create-"</span>, <span class="fl">1</span>:<span class="no">n</span>),
                        <span class="kw">My_External_Id__c</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="no">prefix</span>, <span class="no">letters</span>[<span class="fl">1</span>:<span class="no">n</span>]))
<span class="no">new_contacts2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">tibble</a></span>(<span class="kw">FirstName</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="st">"Test"</span>, <span class="no">n</span>),
                        <span class="kw">LastName</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"Contact-Create-"</span>, <span class="fl">1</span>:<span class="no">n</span>),
                        <span class="kw">My_External_Id__c</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="no">prefix</span>, <span class="no">letters</span>[<span class="fl">1</span>:<span class="no">n</span>]))</pre></body></html></div>
<p>There are some differences in the way the REST API returns response information vs.  the Bulk 1.0 API. However, the changes in Salesforce are exactly the same for these two calls.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="co"># REST</span>
<span class="no">rest_created_records</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/sf_create.html">sf_create</a></span>(<span class="no">new_contacts1</span>, <span class="kw">object_name</span><span class="kw">=</span><span class="st">"Contact"</span>, <span class="kw">api_type</span><span class="kw">=</span><span class="st">"REST"</span>)
<span class="no">rest_created_records</span>
<span class="co">#&gt; # A tibble: 2 x 2</span>
<span class="co">#&gt;   id                 success</span>
<span class="co">#&gt;   &lt;chr&gt;              &lt;lgl&gt;  </span>
<span class="co">#&gt; 1 0033s000012NzTzAAK TRUE   </span>
<span class="co">#&gt; 2 0033s000012NzU0AAK TRUE</span>

<span class="co"># Bulk</span>
<span class="no">bulk_created_records</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/sf_create.html">sf_create</a></span>(<span class="no">new_contacts2</span>, <span class="kw">object_name</span><span class="kw">=</span><span class="st">"Contact"</span>, <span class="kw">api_type</span><span class="kw">=</span><span class="st">"Bulk 1.0"</span>)
<span class="no">bulk_created_records</span>
<span class="co">#&gt; # A tibble: 2 x 4</span>
<span class="co">#&gt;   Id    Success Created Error                                                   </span>
<span class="co">#&gt;   &lt;lgl&gt; &lt;lgl&gt;   &lt;lgl&gt;   &lt;chr&gt;                                                   </span>
<span class="co">#&gt; 1 NA    FALSE   FALSE   DUPLICATE_VALUE:duplicate value found: My_External_Id__…</span>
<span class="co">#&gt; 2 NA    FALSE   FALSE   DUPLICATE_VALUE:duplicate value found: My_External_Id__…</span></pre></body></html></div>
</div>
<div id="a-complete-bulk-api-workflow" class="section level2">
<h2 class="hasAnchor">
<a href="#a-complete-bulk-api-workflow" class="anchor"></a>A Complete Bulk API Workflow</h2>
<p>To show a more lengthy example of using the Bulk 1.0 API, below is a workflow of that creates 2 records, queries them, and deletes them. This is just an example. Typically, you’d want to use the Bulk APIs over the REST or SOAP APIs when dealing with over 10,000 records.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">object</span> <span class="kw">&lt;-</span> <span class="st">"Contact"</span>
<span class="no">created_records</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/sf_create.html">sf_create</a></span>(<span class="no">new_contacts</span>, <span class="kw">object_name</span><span class="kw">=</span><span class="no">object</span>, <span class="kw">api_type</span><span class="kw">=</span><span class="st">"Bulk 1.0"</span>)
<span class="no">created_records</span>
<span class="co">#&gt; # A tibble: 2 x 4</span>
<span class="co">#&gt;   Id                 Success Created Error</span>
<span class="co">#&gt;   &lt;chr&gt;              &lt;lgl&gt;   &lt;lgl&gt;   &lt;lgl&gt;</span>
<span class="co">#&gt; 1 0033s000012NzCMAA0 TRUE    TRUE    NA   </span>
<span class="co">#&gt; 2 0033s000012NzCNAA0 TRUE    TRUE    NA</span>

<span class="co"># query bulk</span>
<span class="no">my_soql</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span>(<span class="st">"SELECT Id,
                           FirstName, 
                           LastName
                    FROM Contact 
                    WHERE Id in ('%s')"</span>,
                   <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="no">created_records</span>$<span class="no">Id</span> , <span class="kw">collapse</span><span class="kw">=</span><span class="st">"','"</span>))

<span class="no">queried_records</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/sf_query.html">sf_query</a></span>(<span class="no">my_soql</span>, <span class="kw">object_name</span><span class="kw">=</span><span class="no">object</span>, <span class="kw">api_type</span><span class="kw">=</span><span class="st">"Bulk 1.0"</span>)
<span class="no">queried_records</span>
<span class="co">#&gt; # A tibble: 2 x 3</span>
<span class="co">#&gt;   Id                 FirstName LastName        </span>
<span class="co">#&gt;   &lt;chr&gt;              &lt;chr&gt;     &lt;chr&gt;           </span>
<span class="co">#&gt; 1 0033s000012NzCMAA0 Test      Contact-Create-1</span>
<span class="co">#&gt; 2 0033s000012NzCNAA0 Test      Contact-Create-2</span>

<span class="co"># delete bulk</span>
<span class="no">deleted_records</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/sf_delete.html">sf_delete</a></span>(<span class="no">queried_records</span>$<span class="no">Id</span>, <span class="kw">object_name</span><span class="kw">=</span><span class="no">object</span>, <span class="kw">api_type</span><span class="kw">=</span><span class="st">"Bulk 1.0"</span>)
<span class="no">deleted_records</span>
<span class="co">#&gt; # A tibble: 2 x 4</span>
<span class="co">#&gt;   Id                 Success Created Error</span>
<span class="co">#&gt;   &lt;chr&gt;              &lt;lgl&gt;   &lt;lgl&gt;   &lt;lgl&gt;</span>
<span class="co">#&gt; 1 0033s000012NzCMAA0 TRUE    FALSE   NA   </span>
<span class="co">#&gt; 2 0033s000012NzCNAA0 TRUE    FALSE   NA</span></pre></body></html></div>
</div>
<div id="query-limitations" class="section level2">
<h2 class="hasAnchor">
<a href="#query-limitations" class="anchor"></a>Query Limitations</h2>
<p>There is one limitation to Bulk queries is that it does not support the following operations or structures of SOQL:</p>
<ul>
<li>COUNT</li>
<li>ROLLUP</li>
<li>SUM</li>
<li>GROUP BY CUBE</li>
<li>OFFSET</li>
<li>Nested SOQL queries</li>
<li>Relationship fields</li>
<li>Compound address fields</li>
<li>Compound geolocation fields</li>
</ul>
</div>
<div id="using-the-bulk-2-0-api" class="section level2">
<h2 class="hasAnchor">
<a href="#using-the-bulk-2-0-api" class="anchor"></a>Using the Bulk 2.0 API</h2>
<p>The <strong>salesforcer</strong> package also implements the Bulk 2.0 API which has better speed than the Bulk 1.0 API but sacrifices consistency in the ordering of the result records since they are batched and processed asynchronously. In the example below we first create 10 records in five batches of two records using both the Bulk 1.0 API and then the Bulk 2.0 API. After looking at the results you can see how the returned results are ordered when we process them using the Bulk 1.0 API because after the data is split into batches each batch is processed synchronously which preserves the order of the rows in the returned output. This is not necessarily true of the Bulk 2.0 API which is the point (it’s asynchronicity).</p>
<p><strong>Bulk 1.0</strong></p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">n</span> <span class="kw">&lt;-</span> <span class="fl">10</span>
<span class="no">new_contacts</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">tibble</a></span>(<span class="kw">FirstName</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="st">"Test"</span>, <span class="no">n</span>),
                       <span class="kw">LastName</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"Contact-Create-"</span>, <span class="fl">1</span>:<span class="no">n</span>),
                       <span class="kw">test_number__c</span> <span class="kw">=</span> <span class="fl">1</span>:<span class="fl">10</span>)</pre></body></html></div>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">created_records_v1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/sf_create.html">sf_create</a></span>(<span class="no">new_contacts</span>,
                                <span class="kw">object_name</span> <span class="kw">=</span> <span class="st">"Contact"</span>,
                                <span class="kw">api_type</span> <span class="kw">=</span> <span class="st">"Bulk 1.0"</span>,
                                <span class="kw">batch_size</span> <span class="kw">=</span> <span class="fl">1</span>) <span class="co"># split into 10 batches of 1</span>
<span class="no">created_records_v1</span>
<span class="co">#&gt; # A tibble: 10 x 4</span>
<span class="co">#&gt;    Id                 Success Created Error</span>
<span class="co">#&gt;    &lt;chr&gt;              &lt;lgl&gt;   &lt;lgl&gt;   &lt;lgl&gt;</span>
<span class="co">#&gt;  1 0033s000012NzUEAA0 TRUE    TRUE    NA   </span>
<span class="co">#&gt;  2 0033s000012NzTgAAK TRUE    TRUE    NA   </span>
<span class="co">#&gt;  3 0033s000012NzUOAA0 TRUE    TRUE    NA   </span>
<span class="co">#&gt;  4 0033s000012NzBZAA0 TRUE    TRUE    NA   </span>
<span class="co">#&gt;  5 0033s000012NzBYAA0 TRUE    TRUE    NA   </span>
<span class="co">#&gt;  6 0033s000012NzU9AAK TRUE    TRUE    NA   </span>
<span class="co">#&gt;  7 0033s000012NzThAAK TRUE    TRUE    NA   </span>
<span class="co">#&gt;  8 0033s000012NzC6AAK TRUE    TRUE    NA   </span>
<span class="co">#&gt;  9 0033s000012NzUJAA0 TRUE    TRUE    NA   </span>
<span class="co">#&gt; 10 0033s000012NzBXAA0 TRUE    TRUE    NA</span>

<span class="co"># same ordering of rows!</span>
<span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="no">created_records_v1</span>, <span class="no">new_contacts</span>)
<span class="co">#&gt;                    Id Success Created Error FirstName          LastName</span>
<span class="co">#&gt; 1  0033s000012NzUEAA0    TRUE    TRUE    NA      Test  Contact-Create-1</span>
<span class="co">#&gt; 2  0033s000012NzTgAAK    TRUE    TRUE    NA      Test  Contact-Create-2</span>
<span class="co">#&gt; 3  0033s000012NzUOAA0    TRUE    TRUE    NA      Test  Contact-Create-3</span>
<span class="co">#&gt; 4  0033s000012NzBZAA0    TRUE    TRUE    NA      Test  Contact-Create-4</span>
<span class="co">#&gt; 5  0033s000012NzBYAA0    TRUE    TRUE    NA      Test  Contact-Create-5</span>
<span class="co">#&gt; 6  0033s000012NzU9AAK    TRUE    TRUE    NA      Test  Contact-Create-6</span>
<span class="co">#&gt; 7  0033s000012NzThAAK    TRUE    TRUE    NA      Test  Contact-Create-7</span>
<span class="co">#&gt; 8  0033s000012NzC6AAK    TRUE    TRUE    NA      Test  Contact-Create-8</span>
<span class="co">#&gt; 9  0033s000012NzUJAA0    TRUE    TRUE    NA      Test  Contact-Create-9</span>
<span class="co">#&gt; 10 0033s000012NzBXAA0    TRUE    TRUE    NA      Test Contact-Create-10</span>
<span class="co">#&gt;    test_number__c</span>
<span class="co">#&gt; 1               1</span>
<span class="co">#&gt; 2               2</span>
<span class="co">#&gt; 3               3</span>
<span class="co">#&gt; 4               4</span>
<span class="co">#&gt; 5               5</span>
<span class="co">#&gt; 6               6</span>
<span class="co">#&gt; 7               7</span>
<span class="co">#&gt; 8               8</span>
<span class="co">#&gt; 9               9</span>
<span class="co">#&gt; 10             10</span></pre></body></html></div>
<p>The Bulk 2.0 API returns every single field that was included in the call so if you have an identifying key your dataset, then it should not be a problem to join on that key with your original data to bring in the newly assigned Salesforce Id that is generated when the record is created in Salesforce. However, I have find it wasteful to transfer all of the field information back after the query and have not found a significant performance improvement between the Bulk 1.0 and Bulk 2.0.</p>
<p><strong>Bulk 2.0</strong></p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">created_records_v2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/sf_create.html">sf_create</a></span>(<span class="no">new_contacts</span>,
                                <span class="kw">object_name</span> <span class="kw">=</span> <span class="st">"Contact"</span>,
                                <span class="kw">api_type</span> <span class="kw">=</span> <span class="st">"Bulk 2.0"</span>,
                                <span class="kw">batch_size</span> <span class="kw">=</span> <span class="fl">1</span>)</pre></body></html></div>
<p>The result in Bulk 2.0 API returns all fields so that you can still associate the records if the ordering was changed during processing. However, in this simple case the ordering is still preserved because the number of records processed in this example was not enough to create separate batches to process asynchronously. Finally, note that the field names are different from the Bulk 1.0 API, this is the Salesforcer convention for the Bulk 2.0 API.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">created_records_v2</span>
<span class="co">#&gt; # A tibble: 10 x 6</span>
<span class="co">#&gt;    sf__Id          sf__Created FirstName LastName       test_number__c sf__Error</span>
<span class="co">#&gt;    &lt;chr&gt;           &lt;lgl&gt;       &lt;chr&gt;     &lt;chr&gt;                   &lt;dbl&gt; &lt;chr&gt;    </span>
<span class="co">#&gt;  1 0033s000012Nz8… TRUE        Test      Contact-Creat…              1 &lt;NA&gt;     </span>
<span class="co">#&gt;  2 0033s000012Nz8… TRUE        Test      Contact-Creat…              2 &lt;NA&gt;     </span>
<span class="co">#&gt;  3 0033s000012Nz8… TRUE        Test      Contact-Creat…              3 &lt;NA&gt;     </span>
<span class="co">#&gt;  4 0033s000012NzU… TRUE        Test      Contact-Creat…              4 &lt;NA&gt;     </span>
<span class="co">#&gt;  5 0033s000012NzU… TRUE        Test      Contact-Creat…              5 &lt;NA&gt;     </span>
<span class="co">#&gt;  6 0033s000012NzU… TRUE        Test      Contact-Creat…              6 &lt;NA&gt;     </span>
<span class="co">#&gt;  7 0033s000012NzU… TRUE        Test      Contact-Creat…              7 &lt;NA&gt;     </span>
<span class="co">#&gt;  8 0033s000012NzU… TRUE        Test      Contact-Creat…              8 &lt;NA&gt;     </span>
<span class="co">#&gt;  9 0033s000012NzU… TRUE        Test      Contact-Creat…              9 &lt;NA&gt;     </span>
<span class="co">#&gt; 10 0033s000012NzU… TRUE        Test      Contact-Creat…             10 &lt;NA&gt;</span></pre></body></html></div>
<p>For these above I typically prefer using the Bulk 1.0 API when creating or updating records. That way I can be confident in that the order of the records returned from the process matches the order of the original dataset I put into the process. All of this does not matter when deleting records, so if you want minor performance improvements then switch to the Bulk 2.0 when deleting or querying records.</p>
<p>Here is an example performance benchmark between the Bulk 1.0 and Bulk 2.0 APIs for a small query. You’ll notice that the Bulk 2.0 API is slightly faster. In general, the Bulk 2.0 should be faster and the difference in performance should grow as size of the queried records grows.</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">soql</span> <span class="kw">&lt;-</span> <span class="st">"SELECT Id, Name FROM Contact"</span>
<span class="no">bulk1_query</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(){<span class="fu"><a href="../reference/sf_query.html">sf_query</a></span>(<span class="no">soql</span>, <span class="st">"Contact"</span>, <span class="kw">api_type</span><span class="kw">=</span><span class="st">"Bulk 1.0"</span>)}
<span class="no">bulk2_query</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(){<span class="fu"><a href="../reference/sf_query.html">sf_query</a></span>(<span class="no">soql</span>, <span class="kw">api_type</span><span class="kw">=</span><span class="st">"Bulk 2.0"</span>)} <span class="co"># the Bulk 2.0 does not need the object name</span>

<span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html">microbenchmark</a></span>(<span class="no">bulk1_query</span>, <span class="no">bulk2_query</span>, <span class="kw">times</span><span class="kw">=</span><span class="fl">10</span>)
<span class="co">#&gt; Unit: nanoseconds</span>
<span class="co">#&gt;         expr min lq  mean median uq  max neval</span>
<span class="co">#&gt;  bulk1_query  30 35  84.0     36 36  528    10</span>
<span class="co">#&gt;  bulk2_query  31 36 398.9     36 37 3551    10</span></pre></body></html></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Steven M. Mortimer.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: 'c7d5ea1103660127418415a82a24fc3d',
    indexName: 'salesforcer',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
